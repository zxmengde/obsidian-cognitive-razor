# 发布流程快速参考

本文档提供 Cognitive Razor 插件发布流程的快速参考。

## 快速发布步骤

### 1. 准备发布

```bash
# 确保所有测试通过
npm test

# 构建生产版本
npm run build

# 验证发布文件
npm run verify-release
```

### 2. 更新版本号

根据变更类型选择：

```bash
# 补丁版本（bug 修复）：1.0.0 -> 1.0.1
npm version patch

# 次要版本（新功能）：1.0.0 -> 1.1.0
npm version minor

# 主要版本（重大变更）：1.0.0 -> 2.0.0
npm version major
```

这会自动：
- 更新 `package.json` 中的版本号
- 更新 `manifest.json` 中的版本号
- 更新 `versions.json`
- 创建 Git commit

### 3. 更新 CHANGELOG.md

在 `CHANGELOG.md` 中添加新版本的变更说明：

```markdown
## [1.0.1] - 2025-12-07

### 修复
- 修复了 XXX 问题
- 改进了 YYY 性能

### 变更
- 更新了 ZZZ 功能
```

### 4. 提交更改

```bash
# 添加 CHANGELOG.md
git add CHANGELOG.md

# 提交
git commit -m "docs: update changelog for v1.0.1"

# 推送到远程
git push origin main
```

### 5. 创建并推送标签

```bash
# 创建标签（注意：不要使用 'v' 前缀）
git tag 1.0.1

# 推送标签
git push origin 1.0.1
```

### 6. 创建 GitHub Release

#### 自动方式（推荐）

如果配置了 GitHub Actions，推送标签后会自动创建 Release。

#### 手动方式

1. 访问 GitHub 仓库的 Releases 页面
2. 点击 "Draft a new release"
3. 选择刚才创建的标签
4. 填写 Release 标题：`Cognitive Razor 1.0.1`
5. 复制 CHANGELOG.md 中的相关内容到 Release 说明
6. 上传文件：
   - `main.js`
   - `manifest.json`
   - `styles.css`
7. 点击 "Publish release"

### 7. 验证发布

```bash
# 下载发布的文件
curl -L -O https://github.com/your-username/obsidian-cognitive-razor/releases/download/1.0.1/main.js
curl -L -O https://github.com/your-username/obsidian-cognitive-razor/releases/download/1.0.1/manifest.json
curl -L -O https://github.com/your-username/obsidian-cognitive-razor/releases/download/1.0.1/styles.css

# 在测试 vault 中安装并测试
```

## 常见问题

### Q: 如何回滚发布？

```bash
# 1. 删除 GitHub Release（在网页上操作）

# 2. 删除本地标签
git tag -d 1.0.1

# 3. 删除远程标签
git push origin :refs/tags/1.0.1

# 4. 修复问题后重新发布
```

### Q: 如何发布预发布版本？

```bash
# 使用预发布版本号
npm version 1.1.0-beta.1

# 在 GitHub Release 中勾选 "This is a pre-release"
```

### Q: 版本号规则是什么？

- **主版本号（Major）**：不兼容的 API 变更
- **次版本号（Minor）**：向后兼容的新功能
- **修订号（Patch）**：向后兼容的 bug 修复

### Q: 如何更新社区插件市场？

首次发布后：
1. Fork [obsidian-releases](https://github.com/obsidianmd/obsidian-releases)
2. 在 `community-plugins.json` 中添加插件信息
3. 创建 Pull Request

后续更新会自动同步（通过 GitHub Releases）。

## 发布检查清单

使用完整的检查清单：[.github/RELEASE_CHECKLIST.md](../.github/RELEASE_CHECKLIST.md)

## 自动化脚本

### 验证发布文件

```bash
npm run verify-release
```

### 准备发布（构建 + 验证）

```bash
npm run prepare-release
```

## 发布时间建议

- **补丁版本**：随时发布（修复严重 bug）
- **次要版本**：每 2-4 周发布一次
- **主要版本**：每 3-6 个月发布一次

## 发布后任务

1. 在 GitHub Discussions 发布公告
2. 更新文档（如有必要）
3. 通知测试用户
4. 监控 Issues 中的反馈
5. 准备下一个版本的计划

## 紧急修复流程

如果发现严重 bug 需要紧急修复：

```bash
# 1. 创建修复分支
git checkout -b hotfix/critical-bug

# 2. 修复 bug
# ... 编辑代码 ...

# 3. 测试
npm test

# 4. 合并到 main
git checkout main
git merge hotfix/critical-bug

# 5. 发布补丁版本
npm version patch
npm run build
git push origin main
git push origin <version>

# 6. 创建 GitHub Release
```

## 版本命名示例

- `1.0.0` - 首次正式发布
- `1.0.1` - Bug 修复
- `1.1.0` - 新功能
- `1.1.1` - Bug 修复
- `2.0.0` - 重大变更
- `2.0.0-beta.1` - 预发布版本
- `2.0.0-rc.1` - 候选发布版本

## 相关文档

- [RELEASE.md](../RELEASE.md) - 详细发布指南
- [CHANGELOG.md](../CHANGELOG.md) - 版本变更日志
- [.github/RELEASE_CHECKLIST.md](../.github/RELEASE_CHECKLIST.md) - 发布检查清单
- [.github/workflows/release.yml](../.github/workflows/release.yml) - 自动发布工作流

## 联系方式

如有发布相关问题：
- GitHub Issues: https://github.com/your-username/obsidian-cognitive-razor/issues
- GitHub Discussions: https://github.com/your-username/obsidian-cognitive-razor/discussions

# 实现计划

- [x] 1. 创建通用 Modal 组件





  - 创建 TextInputModal、SelectModal、ConfirmModal 和 ProviderConfigModal 组件
  - 实现焦点管理和键盘导航
  - 实现输入验证和错误显示
  - _需求：2.1, 2.2, 2.3, 2.4, 2.5, 10.1, 10.2, 10.3, 10.4, 10.5_

- [x] 1.1 编写属性测试：Modal 替代 prompt


  - **属性 4: Modal 替代 prompt**
  - **验证需求：2.1, 10.1, 10.2, 10.3**

- [x] 1.2 编写属性测试：Modal 取消不保存

  - **属性 7: Modal 取消不保存**
  - **验证需求：2.5, 10.5**

- [x] 1.3 编写属性测试：Modal 焦点管理

  - **属性 27: Modal 焦点管理**
  - **验证需求：10.4**


- [x] 2. 简化 ProviderManager 并添加自定义端点支持




  - 从 ProviderManager 中移除 OpenRouterProvider 类
  - 更新 ProviderType 类型定义，移除 'openrouter'
  - 为 OpenAIProvider 和 GeminiProvider 添加自定义 baseUrl 支持
  - 更新默认端点配置
  - _需求：1.1, 1.2, 1.3, 1.5_

- [x] 2.1 编写属性测试：Provider 类型限制


  - **属性 1: Provider 类型限制**
  - **验证需求：1.1**

- [x] 2.2 编写属性测试：自定义端点持久化


  - **属性 3: 自定义端点持久化**




  - **验证需求：1.5**

- [ ] 3. 实现 URL 验证功能

  - 创建 validateUrl 函数
  - 实现 HTTP/HTTPS 格式检查






  - 实现 URL 解析验证
  - 添加友好的错误消息
  - _需求：1.4, 3.3_

- [ ] 3.1 编写属性测试：URL 格式验证
  - **属性 2: URL 格式验证**
  - **验证需求：1.4, 3.3**

- [ ] 4. 更新 SettingsTab 使用 Modal 组件



  - 替换 showAddProviderModal 中的 prompt() 为 ProviderConfigModal
  - 替换 showEditProviderModal 中的 prompt() 为 ProviderConfigModal

  - 实现"测试连接"按钮功能
  - 实现"编辑提供商"按钮功能
  - 实现"设为默认"按钮功能

  - 实现"清除日志"按钮功能
  - 实现"重置设置"按钮功能（使用 ConfirmModal）
  - 在 Provider 配置中添加自定义端点输入框

  - _需求：2.1, 2.2, 2.3, 2.4, 2.5, 9.1, 9.2, 9.3, 9.4, 9.5_

- [x] 4.1 编写属性测试：Provider 类型表单映射

  - **属性 5: Provider 类型表单映射**




  - **验证需求：2.2, 3.2**

- [ ] 4.2 编写属性测试：配置保存完整性
  - **属性 6: 配置保存完整性**
  - **验证需求：2.4, 3.4**





- [ ] 4.3 编写属性测试：默认 Provider 更新
  - **属性 24: 默认 Provider 更新**
  - **验证需求：9.2**

- [ ] 4.4 编写属性测试：日志清除
  - **属性 25: 日志清除**
  - **验证需求：9.3**


- [ ] 4.5 编写属性测试：设置重置
  - **属性 26: 设置重置**
  - **验证需求：9.5**


- [ ] 5. 更新 SetupWizard 移除 OpenRouter 并添加自定义端点


  - 从 renderSelectProvider 中移除 OpenRouter 卡片



  - 移除 renderConfigureOpenRouter 方法

  - 在 renderConfigureGoogle 和 renderConfigureOpenAI 中添加自定义端点输入框
  - 更新 setDefaultModels 移除 OpenRouter 分支
  - 更新欢迎向导的说明文本
  - _需求：3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 6. 实现 WorkbenchPanel 创建概念功能



  - 实现 renderCreateSection 方法


  - 实现概念描述输入框
  - 实现"标准化"按钮和 handleStandardize 方法


  - 实现标准化结果显示（中英文名、别名、类型置信度）
  - 实现"创建"按钮和 handleCreate 方法






  - 创建 Stub 笔记并触发 enrich 任务
  - 在编辑器中打开新创建的笔记
  - _需求：4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 6.1 编写属性测试：标准化输出触发
  - **属性 8: 标准化输出触发**
  - **验证需求：4.2**

- [x] 6.2 编写属性测试：标准化结果显示完整性


  - **属性 9: 标准化结果显示完整性**
  - **验证需求：4.3**



- [x] 6.3 编写属性测试：笔记创建触发






  - **属性 10: 笔记创建触发**
  - **验证需求：4.4**

- [ ] 7. 实现 WorkbenchPanel 重复概念管理功能

  - 实现 renderDuplicatesSection 方法
  - 显示重复对列表（名称、相似度、类型）
  - 实现点击重复对显示预览功能


  - 实现"合并"按钮和 handleMerge 方法
  - 实现"忽略"按钮和 handleDismiss 方法


  - _需求：6.1, 6.2, 6.3, 6.4, 6.5_






- [-] 7.1 编写属性测试：重复对显示

  - **属性 14: 重复对显示**
  - **验证需求：6.1**

- [ ] 7.2 编写属性测试：合并任务生成
  - **属性 15: 合并任务生成**
  - **验证需求：6.3**



- [ ] 7.3 编写属性测试：重复对忽略状态
  - **属性 16: 重复对忽略状态**


  - **验证需求：6.4**







- [ ] 7.4 编写属性测试：合并完成清理
  - **属性 17: 合并完成清理**
  - **验证需求：6.5**

- [x] 8. 实现 QueueView 任务队列详情功能




  - 实现 renderTaskList 方法
  - 显示任务列表（类型、状态、进度、创建时间）
  - 实现任务分组（进行中、等待中、已完成、失败）
  - 实现 handleTaskClick 展开任务详情
  - 实现"取消"按钮和 handleCancel 方法




  - 实现"重试"按钮和 handleRetry 方法
  - 实现队列控制按钮（暂停、恢复、清空）
  - _需求：5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 8.1 编写属性测试：队列视图任务完整性



  - **属性 11: 队列视图任务完整性**
  - **验证需求：5.1, 5.2**

- [ ] 8.2 编写属性测试：任务取消状态更新
  - **属性 12: 任务取消状态更新**
  - **验证需求：5.4**





- [ ] 8.3 编写属性测试：任务重试入队
  - **属性 13: 任务重试入队**
  - **验证需求：5.5**

- [ ] 9. 实现增量改进功能

  - 在笔记右键菜单中添加"增量改进"菜单项
  - 实现意图输入 Modal（使用 TextInputModal）
  - 实现 handleIncrementalImprove 方法生成改进任务
  - 改进任务完成后打开 DiffView
  - 在 DiffView 中实现确认写入功能
  - 写入前创建快照
  - _需求：7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 9.1 编写属性测试：增量改进任务生成
  - **属性 18: 增量改进任务生成**
  - **验证需求：7.3**

- [ ] 9.2 编写属性测试：改进完成 DiffView 显示
  - **属性 19: 改进完成 DiffView 显示**
  - **验证需求：7.4**

- [ ] 9.3 编写属性测试：改进确认快照创建
  - **属性 20: 改进确认快照创建**
  - **验证需求：7.5**

- [ ] 10. 实现撤销功能

  - 在写入操作的通知中添加"撤销"按钮
  - 实现撤销按钮点击处理（5 秒内有效）
  - 实现操作历史视图
  - 显示所有可撤销的操作（时间、文件路径、操作类型）
  - 实现从历史中选择操作并撤销
  - 撤销时恢复快照并删除快照文件
  - _需求：8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 10.1 编写属性测试：撤销按钮显示
  - **属性 21: 撤销按钮显示**
  - **验证需求：8.1**

- [ ] 10.2 编写属性测试：撤销恢复内容
  - **属性 22: 撤销恢复内容**
  - **验证需求：8.2**

- [ ] 10.3 编写属性测试：操作历史完整性
  - **属性 23: 操作历史完整性**
  - **验证需求：8.3**

- [ ] 11. 实现配置迁移功能

  - 创建 migrateToV2 函数
  - 检测 OpenRouter 配置并显示迁移提示
  - 实现迁移向导（使用 Modal）
  - 为现有 Provider 添加默认 baseUrl
  - 更新配置文件版本号
  - _需求：所有（向后兼容）_

- [ ] 12. 更新样式和主题

  - 为新 Modal 组件添加样式
  - 更新 WorkbenchPanel 样式（创建区域、重复面板）
  - 更新 QueueView 样式（任务列表、分组）
  - 更新 DiffView 样式
  - 确保暗色主题兼容性
  - _需求：所有（UI）_

- [ ] 13. 更新类型定义

  - 更新 ProviderType 类型定义
  - 更新 ProviderConfig 接口
  - 添加 StandardizedConcept 接口
  - 添加 TaskDetails 接口
  - 添加 Modal 组件相关类型
  - _需求：所有_

- [ ] 14. 更新文档

  - 更新 README.md 说明 Provider 变更
  - 更新快速开始指南
  - 添加自定义端点配置说明
  - 添加迁移指南（从 OpenRouter）
  - 更新常见问题解答
  - _需求：所有_

- [ ] 15. 最终检查点

  - 确保所有测试通过
  - 验证所有功能正常工作
  - 检查 UI 响应性和可访问性
  - 验证配置迁移功能
  - 测试各种边缘情况
  - _需求：所有_
